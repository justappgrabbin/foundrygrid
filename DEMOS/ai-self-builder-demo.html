<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI-Powered Self-Building System - Foundry</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
      background: #0a0a0a;
      color: #00ff88;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 40px;
      padding: 40px 20px;
      background: linear-gradient(135deg, rgba(255,170,0,0.1) 0%, rgba(255,0,255,0.1) 100%);
      border-radius: 20px;
    }
    
    h1 {
      color: #ffaa00;
      font-size: 42px;
      margin-bottom: 10px;
    }
    
    .tagline {
      color: #ff00ff;
      font-size: 16px;
      margin-bottom: 20px;
    }
    
    .status-banner {
      display: inline-flex;
      gap: 15px;
      padding: 10px 20px;
      background: rgba(0,255,136,0.1);
      border: 1px solid #00ff88;
      border-radius: 10px;
      font-size: 13px;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #00ff88;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
    
    .main-grid {
      display: grid;
      grid-template-columns: 350px 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    @media (max-width: 1024px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .sidebar {
      background: rgba(255,255,255,0.02);
      border: 1px solid #333;
      border-radius: 15px;
      padding: 25px;
    }
    
    .sidebar-section {
      margin-bottom: 30px;
    }
    
    .sidebar-section:last-child {
      margin-bottom: 0;
    }
    
    .section-title {
      color: #ffaa00;
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .provider-select {
      width: 100%;
      padding: 12px;
      background: rgba(0,0,0,0.5);
      border: 1px solid #00ff88;
      border-radius: 8px;
      color: #00ff88;
      font-family: inherit;
      font-size: 13px;
      margin-bottom: 10px;
      cursor: pointer;
    }
    
    .api-key-box {
      width: 100%;
      padding: 10px;
      background: rgba(0,0,0,0.5);
      border: 1px solid #333;
      border-radius: 8px;
      color: #888;
      font-family: inherit;
      font-size: 12px;
      margin-bottom: 10px;
    }
    
    .main-panel {
      background: rgba(255,255,255,0.02);
      border: 1px solid #333;
      border-radius: 15px;
      padding: 30px;
    }
    
    .build-section {
      margin-bottom: 30px;
    }
    
    .prompt-input {
      width: 100%;
      min-height: 150px;
      padding: 20px;
      background: rgba(0,0,0,0.5);
      border: 2px solid #ffaa00;
      border-radius: 10px;
      color: #00ff88;
      font-family: inherit;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
      margin-bottom: 15px;
    }
    
    .prompt-input::placeholder {
      color: #555;
    }
    
    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .option-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .option-label {
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .option-select {
      padding: 10px;
      background: rgba(0,0,0,0.5);
      border: 1px solid #333;
      border-radius: 6px;
      color: #00ff88;
      font-family: inherit;
      font-size: 13px;
    }
    
    .btn {
      padding: 15px 30px;
      background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
      border: none;
      border-radius: 10px;
      color: #000;
      font-family: inherit;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      width: 100%;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(0,255,136,0.3);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn.secondary {
      background: rgba(255,255,255,0.1);
      color: #00ff88;
      border: 1px solid #00ff88;
    }
    
    .output-section {
      margin-top: 30px;
      display: none;
    }
    
    .output-section.visible {
      display: block;
    }
    
    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .output-title {
      color: #ff00ff;
      font-size: 18px;
      font-weight: bold;
    }
    
    .output-actions {
      display: flex;
      gap: 10px;
    }
    
    .icon-btn {
      padding: 8px 15px;
      background: rgba(255,255,255,0.1);
      border: 1px solid #00ff88;
      border-radius: 6px;
      color: #00ff88;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .icon-btn:hover {
      background: rgba(0,255,136,0.1);
    }
    
    .code-preview {
      background: rgba(0,0,0,0.8);
      border: 1px solid #333;
      border-radius: 10px;
      padding: 20px;
      color: #00ff88;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.6;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      margin-bottom: 15px;
    }
    
    .preview-iframe {
      width: 100%;
      height: 500px;
      border: 2px solid #00ff88;
      border-radius: 10px;
      background: white;
    }
    
    .stats-panel {
      background: rgba(255,0,255,0.1);
      border: 1px solid #ff00ff;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-value {
      color: #ff00ff;
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .stat-label {
      color: #888;
      font-size: 11px;
      text-transform: uppercase;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #ffaa00;
      font-size: 16px;
    }
    
    .loading::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }
    
    @keyframes dots {
      0%, 20% { content: ''; }
      40% { content: '.'; }
      60% { content: '..'; }
      80%, 100% { content: '...'; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ü§ñ AI-Powered Self-Building System</h1>
      <p class="tagline">Describe anything, get a working app. Powered by Claude, GPT, Gemini, or Ollama.</p>
      <div class="status-banner">
        <div class="status-item">
          <div class="status-dot"></div>
          <span id="provider-status">Initializing...</span>
        </div>
        <div class="status-item">
          <span id="build-count">0 builds</span>
        </div>
        <div class="status-item">
          <span id="total-cost">$0.00 spent</span>
        </div>
      </div>
    </header>
    
    <div class="main-grid">
      <!-- SIDEBAR -->
      <div class="sidebar">
        <div class="sidebar-section">
          <div class="section-title">üéõÔ∏è AI Provider</div>
          <select class="provider-select" id="provider-select">
            <option value="">Detecting providers...</option>
          </select>
          <select class="provider-select" id="model-select">
            <option value="">Select model...</option>
          </select>
          <input 
            type="password" 
            class="api-key-box" 
            id="api-key-input"
            placeholder="API Key (if required)"
          >
          <button class="btn secondary" onclick="saveAPIKey()" style="font-size: 12px; padding: 8px;">
            Save API Key
          </button>
        </div>
        
        <div class="sidebar-section">
          <div class="section-title">‚ö° Quick Examples</div>
          <button class="btn secondary" onclick="loadExample(0)" style="margin-bottom: 8px; padding: 10px; font-size: 12px;">
            Consciousness Tracker
          </button>
          <button class="btn secondary" onclick="loadExample(1)" style="margin-bottom: 8px; padding: 10px; font-size: 12px;">
            Meditation Timer
          </button>
          <button class="btn secondary" onclick="loadExample(2)" style="padding: 10px; font-size: 12px;">
            Flow State Game
          </button>
        </div>
      </div>
      
      <!-- MAIN PANEL -->
      <div class="main-panel">
        <div class="build-section">
          <div class="section-title">‚ú® Describe What You Want to Build</div>
          <textarea 
            class="prompt-input" 
            id="prompt-input"
            placeholder="Example:&#10;&#10;Build an interactive consciousness tracker that lets me track my active Human Design gates throughout the day. It should have a visual grid of all 64 gates, let me click to activate/deactivate them, and show statistics about which gates I use most. Make it beautiful with neon colors and smooth animations."
          ></textarea>
          
          <div class="options-grid">
            <div class="option-group">
              <label class="option-label">App Type</label>
              <select class="option-select" id="app-type">
                <option value="app">Interactive App</option>
                <option value="game">Game</option>
                <option value="tool">Utility Tool</option>
                <option value="visualization">Visualization</option>
              </select>
            </div>
            
            <div class="option-group">
              <label class="option-label">Framework</label>
              <select class="option-select" id="framework">
                <option value="vanilla">HTML/JS</option>
                <option value="react">React</option>
                <option value="p5">p5.js</option>
                <option value="canvas">Canvas</option>
              </select>
            </div>
          </div>
          
          <button class="btn" id="build-btn" onclick="buildApp()">
            üèóÔ∏è Build App with AI
          </button>
        </div>
        
        <div class="output-section" id="output-section">
          <div class="output-header">
            <div class="output-title">üì¶ Generated App</div>
            <div class="output-actions">
              <button class="icon-btn" onclick="downloadApp()">üíæ Download</button>
              <button class="icon-btn" onclick="copyCode()">üìã Copy Code</button>
              <button class="icon-btn" onclick="toggleView()">üëÅÔ∏è Toggle View</button>
            </div>
          </div>
          
          <div id="code-view" class="code-preview"></div>
          <iframe id="preview-iframe" class="preview-iframe" style="display: none;"></iframe>
          
          <div class="stats-panel">
            <div class="stats-grid">
              <div class="stat-item">
                <div class="stat-value" id="gen-provider">-</div>
                <div class="stat-label">Provider</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="gen-tokens">-</div>
                <div class="stat-label">Tokens</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="gen-cost">-</div>
                <div class="stat-label">Cost</div>
              </div>
              <div class="stat-item">
                <div class="stat-value" id="gen-time">-</div>
                <div class="stat-label">Time</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script src="ai-provider-engine.js"></script>
  <script src="ai-enabled-builder.js"></script>
  <script>
    // Initialize
    const builder = new AIEnabledBuilder();
    let currentCode = '';
    let viewMode = 'code'; // 'code' or 'preview'
    
    const examples = [
      {
        prompt: "Build an interactive consciousness tracker that lets me track my active Human Design gates throughout the day. It should have a visual grid of all 64 gates, let me click to activate/deactivate them, and show statistics about which gates I use most. Make it beautiful with neon colors and smooth animations.",
        type: 'app',
        framework: 'vanilla'
      },
      {
        prompt: "Create a meditation timer with breathing exercises. Show a visual circle that expands and contracts for breathwork (4 seconds in, 7 seconds hold, 8 seconds out). Include calming background colors that shift slowly. Add a progress bar and session statistics.",
        type: 'tool',
        framework: 'vanilla'
      },
      {
        prompt: "Build a flow state game where the player navigates a particle through a field of obstacles. The obstacles should move in wave patterns. The game should get progressively harder. Make it visually stunning with particle effects and glowing trails.",
        type: 'game',
        framework: 'p5'
      }
    ];
    
    // Initialize on load
    window.addEventListener('load', async () => {
      await builder.initialize({
        fallbackChain: ['claude', 'openai', 'gemini', 'ollama']
      });
      
      updateProviderSelect();
      updateStatus();
    });
    
    function updateProviderSelect() {
      const select = document.getElementById('provider-select');
      const providers = builder.getProviderList();
      
      select.innerHTML = providers.map(p => 
        `<option value="${p.id}" ${p.isActive ? 'selected' : ''}>
          ${p.name} ${p.hasKey || !p.requiresKey ? '‚úì' : '‚ö†Ô∏è'}
        </option>`
      ).join('');
      
      updateModelSelect();
    }
    
    function updateModelSelect() {
      const providerId = document.getElementById('provider-select').value;
      const modelSelect = document.getElementById('model-select');
      const provider = builder.aiEngine.providers.get(providerId);
      
      if (!provider) return;
      
      modelSelect.innerHTML = provider.models.map(m =>
        `<option value="${m.id}" ${m.id === provider.defaultModel ? 'selected' : ''}>
          ${m.name} ${m.cost > 0 ? `($${m.cost}/1K)` : '(Free)'}
        </option>`
      ).join('');
    }
    
    document.getElementById('provider-select').addEventListener('change', (e) => {
      builder.aiEngine.setActiveProvider(e.target.value);
      updateModelSelect();
      updateStatus();
    });
    
    function updateStatus() {
      const providers = builder.getProviderList();
      const active = providers.find(p => p.isActive);
      
      document.getElementById('provider-status').textContent = 
        active ? `${active.name} Ready` : 'No Provider';
      
      const stats = builder.getStats();
      document.getElementById('build-count').textContent = `${stats.builds.total} builds`;
      document.getElementById('total-cost').textContent = `$${stats.builds.totalCost.toFixed(4)} spent`;
    }
    
    function saveAPIKey() {
      const providerId = document.getElementById('provider-select').value;
      const apiKey = document.getElementById('api-key-input').value;
      
      if (!apiKey) {
        alert('Please enter an API key');
        return;
      }
      
      builder.aiEngine.setAPIKey(providerId, apiKey);
      alert('‚úì API key saved');
      updateProviderSelect();
    }
    
    function loadExample(index) {
      const example = examples[index];
      document.getElementById('prompt-input').value = example.prompt;
      document.getElementById('app-type').value = example.type;
      document.getElementById('framework').value = example.framework;
    }
    
    async function buildApp() {
      const prompt = document.getElementById('prompt-input').value;
      const appType = document.getElementById('app-type').value;
      const framework = document.getElementById('framework').value;
      
      if (!prompt.trim()) {
        alert('Please describe what you want to build');
        return;
      }
      
      const buildBtn = document.getElementById('build-btn');
      buildBtn.disabled = true;
      buildBtn.textContent = '‚è≥ Building with AI...';
      
      try {
        const result = await builder.buildFromDescription(prompt, {
          appType: appType,
          framework: framework
        });
        
        currentCode = result.html;
        
        // Show output
        document.getElementById('output-section').classList.add('visible');
        document.getElementById('code-view').textContent = currentCode;
        
        // Update stats
        document.getElementById('gen-provider').textContent = result.metadata.provider;
        document.getElementById('gen-tokens').textContent = result.metadata.tokens;
        document.getElementById('gen-cost').textContent = `$${result.metadata.cost.toFixed(4)}`;
        document.getElementById('gen-time').textContent = '-';
        
        updateStatus();
        
        alert('‚úì App built successfully!');
        
      } catch (error) {
        alert(`Error: ${error.message}\n\nMake sure:\n1. Provider is selected\n2. API key is set (if required)\n3. For Ollama: ollama serve is running`);
        console.error(error);
      } finally {
        buildBtn.disabled = false;
        buildBtn.textContent = 'üèóÔ∏è Build App with AI';
      }
    }
    
    function toggleView() {
      const codeView = document.getElementById('code-view');
      const iframe = document.getElementById('preview-iframe');
      
      if (viewMode === 'code') {
        codeView.style.display = 'none';
        iframe.style.display = 'block';
        
        // Load code into iframe
        const blob = new Blob([currentCode], { type: 'text/html' });
        iframe.src = URL.createObjectURL(blob);
        
        viewMode = 'preview';
      } else {
        codeView.style.display = 'block';
        iframe.style.display = 'none';
        viewMode = 'code';
      }
    }
    
    function copyCode() {
      navigator.clipboard.writeText(currentCode);
      alert('‚úì Code copied to clipboard');
    }
    
    function downloadApp() {
      const blob = new Blob([currentCode], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ai-generated-app-${Date.now()}.html`;
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
